---
title: Erato chatbot API

language_tabs:
  - python: Python

toc_footers:
  - <a href='https://erato.hr'>Erato.hr</a>

includes:
  - errors
  - thresholds

search: true
---
# Uvod

Erato API provides means to get chatbot's answers defined in your [Erato's web console](https://erato.hr). from your chatbot users queries. 
After you **deploy** your chatbot, chatbot gets it's own URL (subdomain) and provides API over SSL for clients to use. 

# Autentifikacija

Chatbot API uses BasicAuth over SSL. You get autogenerated username and password for each deployed chatbot in deployment section of your chatbot.
You provide that username and password with BasicAuth in each API request.

# API metode

Nekoliko je API metoda na raspolaganju za upravljanje vašim objavljenim chatbotom.

## /api/chat/config

```json
{
  "headerBackgroundColor":"#0089d0",
  "headerTextColor":"#ffffff",
  "language":"hr",
  "botIcon":"https://erato.hr/images/logo.png",
  "title":"EratoBot",
  "headerText":"EratoBot",
  "buttonIcon":"https://erato-eratobot-prod.api.expert.erato.hr/static-api/eratobot/img/2f1cd8c1-2fdb-4281-9c30-4ce71c9c5d15.png",
  "headerIcon":"https://erato-eratobot-prod.api.expert.erato.hr/static-api/eratobot/img/13aa4b51-111b-479f-9595-adda0297a096.png"
}
```

Pozivom ove metode dobit ćete konfiguraciju vašeg chatbota, onako kako ste to definirali na platformi (ikone, boje, thresholds, zadani tekstovi, ...).

API metoda | HTTP metoda    
--------- | ------- 
/api/chat/config | GET 


## /api/chat/start

Pozivom ove metode dobit ćete elemente određene teme - defaultno teme "Dobrodošlica". Glavna svrha joj je inicijalno prikazivanje poruke korisnike prilikom prvog pokretanja chatbota. Može se upotrijebiti i za dohvat sadržaja bilo koje teme. Različitost od "message" metode je što ova metoda ne odgovara na neki korisnički upit, nego se direktno dohvaćaju elementi neke teme.

API metoda | HTTP metoda     
--------- | ------- 
/api/chat/start | GET(query parameters)/POST(json) 

#### Zahtjev

Parametri/JSON struktura zahtjeva:

ključ | obavezno | default vrijednost | opis    
--------- | ------- | ------- | ------- 
uid | NE | autogenerating | User ID from external system, if you want to track user's behaviour in chatbot analytics.
sid | NE | autogenerating | Session ID where session is defined as you wish. If you want to track user's behaviour by session in chatbot analytics.
topic | NE | WELCOME | Topic to start. By default it will start "Welcome" topic.
variables-collected | NE | {} | varijable koje želite da chatbot ima na raspolaganju. JSON struktura, gdje je ključ *ime* varijable, a vrijednost je *vrijednost varijable*.

#### Odgovor

Lista elemenata (JSON objekata) odgovora chatbota


## /api/chat/message

Ključna metoda za komunikaciju korisnika sa chatbotom. Pozivom ove metode dobit ćete odgovor(e) chatbota na korisnički upit.

API metoda | HTTP metoda     
--------- | ------- 
/api/chat/message | GET(query parameters)/POST(json) 

#### Zahtjev

Parametri/JSON struktura zahtjeva:

ključ | obavezno | default vrijednost | opis    
--------- | ------- | ------- | ------- 
uid | NE | autogenerating | User ID from external system, if you want to track user's behaviour in chatbot analytics.
sid | NE | autogenerating | Session ID where session is defined as you wish. If you want to track user's behaviour by session in chatbot analytics.
text | bar jedan od [link, value, text] | - | Tekst upita koji je korisnik upisao / tekst buttona koji je korisnik kliknuo.
link | bar jedan od [link, value, text] | - | ID teme do koje vodi gumb koji je korisnik stisnuo (obavezno ako je korisnik kliknuo gumb koji vodi do neke teme - "internal_link")
value | bar jedan od [link, value, text] | - | Vrijednost koja je zadana u gumbu, ako je zadana ("value").
messages | DA | - | Povijest prepiske chatbota i korisnika, zadnjih 20 poruka. Točno onakva struktura kakva dobivena, kronološki (ASC), **uključujući i korisničke upite**.
variables-output | NE | {} | dodatne varijable koje želite da chatbot ima na raspolaganju. JSON struktura, gdje je ključ *ime* varijable, a vrijednost je *vrijednost varijable*.

#### Odgovor

Lista elemenata (JSON objekata) odgovora chatbota.


## /api/chat/continue

Ako želite nastaviti neki od zaustavljenih dijaloga. Obično se ne koristi osim u kompleksnijim integracijama.

API metoda | HTTP metoda     
--------- | ------- 
/api/chat/continue | GET(query parameters)/POST(json) 

#### Zahtjev

Parametri/JSON struktura zahtjeva:

ključ | obavezno | default vrijednost | opis    
--------- | ------- | ------- | ------- 
uid | NE | autogenerating | User ID from external system, if you want to track user's behaviour in chatbot analytics.
sid | NE | autogenerating | Session ID where session is defined as you wish. If you want to track user's behaviour by session in chatbot analytics.
messages | DA | - | Povijest prepiske chatbota i korisnika, zadnjih 20 poruka. Točno onakva struktura kakva dobivena, kronološki (ASC), **uključujući i korisničke upite**.
variables-output | NE | {} | dodatne varijable koje želite da chatbot ima na raspolaganju. JSON struktura, gdje je ključ *ime* varijable, a vrijednost je *vrijednost varijable*.

#### Odgovor

Lista elemenata (JSON objekata) odgovora chatbota


## /api/chat/rating

Korisničko ocjenjivanje chatbot odgovora.

API metoda | HTTP metoda     
--------- | ------- 
/api/chat/rating | GET(query parameters)/POST(json) 

Parametri/JSON struktura zahtjeva:

ključ | obavezno | default vrijednost | opis    
--------- | ------- | ------- | ------- 
uid | NE | autogenerating | User ID from external system, if you want to track user's behaviour in chatbot analytics.
sid | NE | autogenerating | Session ID where session is defined as you wish. If you want to track user's behaviour by session in chatbot analytics.
messages | DA | - | Povijest prepiske chatbota i korisnika, zadnjih 20 poruka. Točno onakva struktura kakva dobivena, kronološki (ASC), **uključujući i korisničke upite**.
botResponse | DA | - | JSON objekt odgovora chatbota koji se ocjenjuje (jedan od JSON objekata iz "messages"). **Unutar njega treba ubaciti "rating" key sa ocjenom od 1 do 5.**

#### Odgovor

Lista elemenata (JSON objekata) odgovora chatbota.


# Response

> **Response JSON body for recognized ACTION**

> **duration** - number of milliseconds EratoExpert used for computing

> **certainy** - percentage of certainty that this answer/action is the correct one for provided query.


```json
{
    "return_code": 0,
    "duration": 76,
    "query": "Query provided in request",
    "query_type": "Corpus type from request, if provided. ACTION or empty for this example.",
    "top_answer": {
            "id": "ITEM ID",
            "variables": {
                "VARIABLE_1": {"_final_": "Some recognized value"}
            },
            "variables-missing": ["list of variables missing for this action"],
            "certainty": 54.12,
            "type": "ACTION"
        },
    "answers": ["up to three JSON dictinaries, same as in top_answer attribute above"],
    "thresholds": {"negative": "20", "differential": "15", "positive": "70"} 
}
```
> **Response JSON body for recognized Q/A (KNOWLEDGE)**

> **answer** - new element, specific for KNOWLEDGE query type. No *action*, *variables* and *variables-missing* anymore.

```json
{
    "return_code": 0,
    "duration": 76,
    "query": "Query provided in request",
    "query_type": "Corpus type set in request, if provided. KNOWLEDGE or empty for this example.",
    "top_answer": {
          "id": "ITEM ID",
          "answer": "This is an answer for this project defined in Q&A section",
          "certainty": 54.12,
          "type": "ACTION"
        },
    "answers": ["up to three JSON dictinaries, same as in top_answer attribute above"],
    "thresholds": {"negative": "20", "differential": "15", "positive": "70"} 
}
```

Response body is in JSON format (application/json).

On the right, you can see two examples (well, combination of example and description) of response JSON. 
On the top is response with ACTION specific JSON attributes, and below it you can see response for Q&A (KNOWLEDGE) specific responses.

Main difference is that ACTION specific response has three attributes that are missing in other: `action`, `variables` and `variables-missing`.
On the other hand, KNOWLEDGE has `answer` attribute that is missing in actions. 

In case you got filled in "variables-missing" key in EratoExpert's response of this method, it means that some specific action was recognized but some of the variables defined for this action were not found in the query.
When you get such response, usually you will call this method again with "action" and "missing" request parameters filled in and EratoExpert will try to retrieve missing variables from new user's query provided in "query" parameter.

<aside class="warning">
Do not forget - if you do not set "corpus" parameter or you send it empty in the request, you can get mixed actions and knowledge answers. Be sure that that is the behavior you are expecting!
</aside>

### Thresholds 
Thresholds dictionary key contains values that you enter in your project settings page on your developer console.
Those settings are just propagated in response without any usage within exection server.
They can be used in your client application using EratoExpert API to tune user experience in regard to certainty sensitivity 
 for each answer you get in answer from EratoExpert execution server.
 
 * `positive` - If answer certainty is higher than this, treat it as a correct answer
 * `negative` - If answer certainty is lower than this, treat it as an incorrect answer
 * `differential` - If the difference of two or more answers are within this number, offer user to select the correct one
  
Since you are the one that will be entering Actions and/or Q&A for your project, you know the best how "similar" the answers might be, so
 you will probably need to adjust this parameters to reflect sensitivity of answers management in your application. 
 
Read more about crafting a good user experience using thresholds [here](#preporuke-za-stvaranje-dobrog-korisnikog-iskustva). 


## Action variables

In EratoExpert web console you can define actions and these actions can contain variables which you want retrieve in response. If variables are recognized by EratoExpert, they will be returned in response as populated values from natural language query. 

Action variables are returned as **JSON dictionary** with minimal set of `_final_` key containing final recognized value for this variable. If there are inner variables inside this variable, they will be inserted as additional keys in this dictionary.

<aside class="notice">
You can read details on how to define variables in your EratoExpert web console.
</aside>

Here are some examples.

### Example 1

> Action variables - Example 1

```json
{
  "variables": {
    "iznos": {
      "_final_": "200"      
  }
}
```

Most basic example is that for given action sentence with one variable, we define static values (or just type in case of number/date) as possible values for this variable.

`plati <iznos:"123"> eura`

Output is shown on the right side for the query sentence `Plaćanje 200 kuna`.

<aside class="notice">
Notice that string "123" after the variable name in action definition is not returned and is used only as an example of variable value. It is mandatory to define variable example as part of the whole action sentence in action definition. 
</aside>


### Example 2

> Action variables - Example 2

```json
{
  "variables": {
    "iznos_i_valuta": {
      "_final_": "200 HRK", 
      "iznos": {
        "_final_": "200"
      },
      "valuta": {
        "_final_": "HRK"
      }
    }
  }
}
```

On the other side, we might want to have currency returned as variable too, in case there can be more currencies in this action.
So, we can define action to contain inner variables too.

`plati <iznos_i_valuta:"123 eura">`

and variable `iznos_i_valuta` is further defined as:

`<iznos:"123"> <valuta:"eura">`, with *valuta* being defined as list of these values: ["HRK", "EUR"], and *iznos* as number type.

In case of request query being `plaćanje 200 kuna`, the JSON output for this action is on the right side.


### Example 3

> Action variables - Example 3

```json
{
  "variables": {
    "iznos_i_valuta": {
      "_final_": "200 HRK", 
      "iznos": {
        "_final_": "200"
      }
    }
  }
}
```

Another example - there can be some static string together with some variable inside a variable. So, starting with action sentence as:

`plati <iznos_i_valuta:"123 kuna">`

and variable `iznos_i_valuta` is this time defined as *iznos* variable (number type) together with static value "HRK":

`<iznos:"123"> HRK`

the output would be as shown on the right side, in case of request query being `plaćanje 200 kuna`.

<aside class="notice">
Notice that "HRK", as static value, is returned only as a part of "_final_" key of the main variable.
</aside>






